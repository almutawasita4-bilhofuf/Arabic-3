<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุฑุงุฌุนุฉ ุนุงูุฉ ููุตู 3ู ู1 ุงููุบุฉ ุงูุนุฑุจูุฉ</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-start: #0f766e;
            --primary-end: #14b8a6;
            --card-bg: #ffffff;
            --correct-color: #059669;
            --incorrect-color: #dc2626;
            --text-main: #1e293b;
            --bg-gradient: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 100px;
            color: var(--text-main);
        }

        /* ุชูุณููุงุช ุงูุฑุฃุณ ูุงูุดุนุงุฑ */
        .header {
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.6);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 800px;
        }

        .header img {
            width: 100px; /* ุญุฌู ุงูุดุนุงุฑ */
            height: auto;
            margin-bottom: 5px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .header h1 {
            font-size: 1.8rem;
            color: #0f766e;
            margin: 0;
            line-height: 1.4;
        }

        .school-name {
            font-size: 1.2rem;
            color: #334155;
            font-weight: 700;
            margin-top: 5px;
            border-top: 2px solid #e2e8f0;
            padding-top: 10px;
            width: 80%;
        }

        /* Mode Selection */
        .mode-selection {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            background: white;
            padding: 5px;
            border-radius: 50px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .mode-btn {
            background: transparent;
            border: none;
            color: #64748b;
            padding: 10px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: var(--primary-start);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(15, 118, 110, 0.4);
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            width: 100%;
            position: fixed;
            bottom: 0;
            left: 0;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border-top: 1px solid #e2e8f0;
        }

        .btn {
            background: var(--primary-start);
            color: white;
            border: none;
            padding: 12px 35px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .btn-reset {
            background: #94a3b8;
        }

        /* Cards Container */
        .cards-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
            max-width: 800px;
            width: 100%;
            padding: 10px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }

        .section-badge {
            display: inline-block;
            background: #f0fdfa;
            color: var(--primary-start);
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 15px;
            border: 1px solid #ccfbf1;
        }

        /* Context Box (The Piece/Poem) */
        .context-box {
            background: #f8fafc;
            border-right: 4px solid var(--primary-start);
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-size: 1.1rem;
            line-height: 1.8;
            color: #334155;
            white-space: pre-line;
            font-weight: 600;
        }

        .sub-question {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #e2e8f0;
        }
        
        .sub-question:first-of-type {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 15px;
        }

        /* ุชุฎุตูุต ุดูู ุงูุฎุท ุชุญุช ุงููููุงุช */
        u {
            text-decoration: none; /* ุฅูุบุงุก ุงูุชุณุทูุฑ ุงูุงูุชุฑุงุถู */
            border-bottom: 2px solid #1e293b; /* ุฎุท ูููุตู ุจููู ุฏุงูู */
            padding-bottom: 6px; /* ูุณุงูุฉ ุจูู ุงููููุฉ ูุงูุฎุท */
            display: inline-block; /* ูุถูุงู ุธููุฑ ุงููุณุงูุฉ ุจุดูู ุตุญูุญ */
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* ุนููุฏูู */
            gap: 12px;
        }

        .option-btn {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-family: 'Tajawal', sans-serif;
            text-align: center;
            transition: all 0.2s;
            color: #64748b;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 55px;
        }

        .option-btn:hover {
            border-color: var(--primary-start);
            background: #f0fdfa;
        }

        .option-btn.selected {
            background: var(--primary-start);
            color: white;
            border-color: var(--primary-start);
        }

        .option-btn.correct-ans {
            background: var(--correct-color) !important;
            color: white !important;
            border-color: var(--correct-color) !important;
        }

        .option-btn.wrong-ans {
            background: var(--incorrect-color) !important;
            color: white !important;
            border-color: var(--incorrect-color) !important;
        }

        .feedback-msg {
            margin-top: 10px;
            font-weight: bold;
            font-size: 1rem;
            display: none;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
        }

        /* Result Popup */
        .overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
            backdrop-filter: blur(5px);
        }

        .stats-popup {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 24px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            text-align: center;
            z-index: 1000;
            display: none;
            width: 90%;
            max-width: 450px;
        }

        .score-circle {
            width: 140px; height: 140px;
            background: var(--primary-start);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 800;
            margin: 0 auto 20px;
            border: 6px solid #ccfbf1;
        }

        @media (max-width: 600px) {
            .header h1 { font-size: 1.5rem; }
            .card { padding: 15px; }
            .options-grid { gap: 10px; }
        }
    </style>
</head>
<body>

    <div class="header">
        <img src="https://z-cdn-media.chatglm.cn/files/18831501-6f8f-4284-a7e3-2b5f219a8b9d_%D8%B4%D8%B9%D8%A7%D8%B1%20%D8%A7%D9%84%D9%88%D8%B2%D8%A7%D8%B1%D9%87.png?auth_key=1791122829-70983e0b353145a3b804341b229af8a4-0-fcc7a582b834bd1790247c1399ff1a0e" alt="ุดุนุงุฑ ุงููุฒุงุฑุฉ">
        <h1>ูุฑุงุฌุนุฉ ุนุงูุฉ ููุตู 3ู ู1 ุงููุบุฉ ุงูุนุฑุจูุฉ</h1>
        <p class="school-name">ุงููุฏุฑุณุฉ ุงููุชูุณุทุฉ ุงูุฑุงุจุนุฉ ุจุงููููู</p>
    </div>

    <div class="mode-selection">
        <button class="mode-btn active" id="btn-exam" onclick="setMode('exam')">๐ ูุถุน ุงูุงุฎุชุจุงุฑ</button>
        <button class="mode-btn" id="btn-practice" onclick="setMode('practice')">๐๏ธ ูุถุน ุงูุชุฏุฑูุจ</button>
    </div>

    <div class="cards-container" id="cardsContainer">
        <!-- Cards injected via JS -->
    </div>

    <div class="controls">
        <button class="btn btn-reset" onclick="initQuiz()">๐ ุฅุนุงุฏุฉ</button>
        <button class="btn" id="finishBtn" onclick="finishQuiz()">โ ุฅููุงุก ูุชุตุญูุญ</button>
    </div>

    <!-- Result Popup -->
    <div class="overlay" id="overlay"></div>
    <div class="stats-popup" id="resultPopup">
        <div class="score-circle" id="scoreCircle">0%</div>
        <h2 style="color:var(--text-main); margin-bottom:10px;">ุงููุชูุฌุฉ ุงูููุงุฆูุฉ</h2>
        <p id="scoreDetails" style="color:#64748b; margin-bottom:20px;"></p>
        <button class="btn" onclick="closePopup()">ุฅุบูุงู</button>
    </div>

    <script>
        // ================= SMART DATA STRUCTURE =================
        const quizData = [
            // --- ุงูุณุคุงู ุงูุฃูู (ุฃ) - ูุณุชููุฉ ---
            {
                section: "ุงูุฃุณุงููุจ ุงููุบููุฉ",
                type: "single",
                questions: [
                    { q: "ููุน ุงูุฃุณููุจ ูู: (ุชุงููู ูู ูุชูุณุฑ ูุฐุง ุฅูุง ุจุงูุนูู):", options: ["ูุณู", "ุดุฑุท", "ุชูุถูู", "ุญุงู"], a: "ูุณู" },
                    { q: "ููุน ุงูุฃุณููุจ ูู: (ููุฉ ูุถูู ุงููุฏู):", options: ["ุชูุถูู", "ูุณู", "ุดุฑุท", "ุญุงู"], a: "ุชูุถูู" }
                ]
            },
            
            // --- ุงูุณุคุงู ุงูุฃูู (ุจ) - ูุณุชููุฉ ---
            {
                section: "ุงูุฅุนุฑุงุจ",
                type: "single",
                questions: [
                    { q: "ุฅุนุฑุงุจ (ูุดุฌุนูู) ูู: ููู ูุงุฏุฉ ุงููุทู ูุดุฌุนูู:", options: ["ุญุงู ููุตูุจุฉ ุจุงููุงุก", "ููุนูู ุจู ููุตูุจ", "ุชูููุฒ ููุตูุจ", "ูุงุนู ูุฑููุน"], a: "ุญุงู ููุตูุจุฉ ุจุงููุงุก" },
                    { q: "ุฅุนุฑุงุจ (ุญุจุง) ูู: ููุช ุงููููุจ ุฅูู ุงูููู ุณููุงู ุญุจุง:", options: ["ุชูููุฒ ููุตูุจ ุจุงููุชุญุฉ", "ุญุงู ููุตูุจุฉ", "ููุนูู ูุฃุฌูู", "ุงุณู ูุฌุฑูุฑ"], a: "ุชูููุฒ ููุตูุจ ุจุงููุชุญุฉ" }
                ]
            },

            // --- ุงูุณุคุงู ุงูุฃูู (ุฌ-1) - ูุต ุดุนุฑู 1 ---
            {
                section: "ุงููุตูุต ุงูุดุนุฑูุฉ (1)",
                type: "group",
                context: "ูุฅู ูุฃูููุง ูุญูู ููุฑุช ูุญูููู ... ูุฅู ููุฏููุง ูุฌุฏู ุจููุช ููู ูุฌุฏุง\nูุฅู ุถูุนูุง ุบูุจู ุญูุธุช ุบููุจูู ... ูุฅู ูููุง ุบูู ูููุช ููู ุฑุดุฏุง",
                questions: [
                    { q: "ูู ุงูุจูุช ุงูุฃูู ุดุจู ุงูุดุงุนุฑ ุฃุจูุงุก ุนูู ุจู:", options: ["ุงููุญูุด ุงูููุชุฑุณุฉ", "ุงูุญููุงูุงุช ุงูุฃูููุฉ", "ุงูุญูุงู", "ุงูุฌูู"], a: "ุงููุญูุด ุงูููุชุฑุณุฉ" },
                    { q: "ูู ุงูุจูุช ุงูุซุงูู ุถุฏ ูููุฉ ( ุชุถููุน ):", options: ["ุญูุธ", "ููุงู", "ุฑุดุฏ", "ุบูุจ"], a: "ุญูุธ" }
                ]
            },

            // --- ุงูุณุคุงู ุงูุฃูู (ุฌ-2) - ูุต ุดุนุฑู 2 ---
            {
                section: "ุงููุตูุต ุงูุดุนุฑูุฉ (2)",
                type: "group",
                context: "ููุฏู ูุฌูุฒ ุงูุบุงุฏูุงุช ููุงูู ... ูุชุฑุงู ูุบุฏู ูุง ููุงู ููุฃุฑุจ\nุญุชู ุงุจุชุณุงูุชู ุงูุชู ุนุฑูุช ุจู ... ุชูุจ ุงููุจูุฑ ููุงุฑู ูุชุญุจุจ",
                questions: [
                    { q: "ูู ุงูุจูุช ุงูุฃูู ุดุจู ุงูุดุงุนุฑ ุนุจุฏ ุงูุฑุญูู ุงูุณุนุฏู ุจู:", options: ["ุงูุณุญุงุจุฉ", "ุงูุฒุฑุน", "ุงูููุฑ", "ุงูุฌุจู"], a: "ุงูุณุญุงุจุฉ" },
                    { q: "ูู ุงูุจูุช ุงูุซุงูู ุถุฏ ูููุฉ ( ุชูุจ ):", options: ["ุชุณูุจ", "ุชุนุทู", "ุชุณุฑุน", "ุชูุฑุฃ"], a: "ุชุณูุจ" }
                ]
            },

            // --- ุงูุณุคุงู ุงูุซุงูู: ุฅููุงุก ููุดุชูุงุช ููุญู ---
            {
                section: "ุงูุฅููุงุก: ุงูุฃูู ุงููููุฉ",
                type: "single",
                questions: [
                    { q: "ุชูุชุจ ุงูุฃูู ุงููููุฉ ูู ุงููุนู ุฏุนู...", options: ["ุง", "ู", "ููุง", "ููู"], a: "ุง" },
                    { q: "ุชูุชุจ ุงูุฃูู ุงููููุฉ ูู ุงููุนู ( ูุถ....) .", options: ["ู", "ุง", "ู", "ู"], a: "ู" },
                    { q: "ุชูุชุจ ุงูุฃูู ุงููููุฉ ูู ุงููุนู (ุงุณุชุญู ....)", options: ["ุง", "ู", "ุจ", "ุฌ"], a: "ุง" },
                    { q: "ุชูุชุจ ุงูุฃูู ุงููููุฉ ูู ุงููุนู ( ุงุณุชูู .... ) .", options: ["ู", "ุง", "ู", "ููุง"], a: "ู" }
                ]
            },
            {
                section: "ุงููุดุชูุงุช ูุงูุฃูุฒุงู",
                type: "single",
                questions: [
                    { q: "ูุง ููุงู ููุบุฑุถ (ุญููุฏ). ูุง ุชุญุชู ุฎุท:", options: ["ุตูุบุฉ ูุจุงูุบุฉ", "ุงุณู ูุงุนู", "ุงุณู ููุนูู", "ุงุณู ุขูุฉ"], a: "ุตูุบุฉ ูุจุงูุบุฉ" },
                    { q: "ุฅู ุชููููุง (ุตุงูุญูู). ููุน ุงููุดุชู:", options: ["ุงุณู ูุงุนู", "ุงุณู ููุนูู", "ุตูุบุฉ ูุจุงูุบุฉ", "ุงุณู ุชูุถูู"], a: "ุงุณู ูุงุนู" },
                    { q: "ูู ุชุนูููู ( ููุงุฆู ) ูุนุงู. ุงููููุฉ ุนูู ูุฒู:", options: ["ูุงุนู", "ููุนูู", "ุฃูุนู", "ููุนุงู"], a: "ูุงุนู" },
                    { q: "ุงูุนูู ( ูุนุฑูู ) ุงููููุฉ ุนูู ูุฒู:", options: ["ููุนูู", "ูุงุนู", "ุฃูุนู", "ููุนุงู"], a: "ููุนูู" },
                    { q: "ูู ููุงุทู ( ุนููู) ุจุฏูุฑู. ุงููููุฉ ุนูู ูุฒู:", options: ["ูุนูู", "ูุงุนู", "ููุนูู", "ููุนุงู"], a: "ูุนูู" },
                    { q: "ุงุณู ุงููุงุนู ูู ุงููุนู ( ูุฌุญ ):", options: ["ูุงุฌุญ", "ููุฌูุญ", "ุฃูุฌุญ", "ูุฌูุญ"], a: "ูุงุฌุญ" },
                    { q: "ุงุณู ุงูููุนูู ูู ุงููุนู ( ุณูุญ ):", options: ["ูุณููุญ", "ุณุงูุญ", "ุณููุญ", "ุฃุณูุญ"], a: "ูุณููุญ" }
                ]
            },
            {
                section: "ุงููุญู (ุงูุชูููุฒ ูุงูุงุณุชุซูุงุก ูุงูุญุงู)",
                type: "single",
                questions: [
                    { q: "ุชุตุฏู ุงูุบูู ุจุตุงุน (ููุญุง). ููุน ุงูุชูููุฒ:", options: ["ููุฑุฏ", "ุฌููุฉ", "ููุงุณู", "ุณูุงุนู"], a: "ููุฑุฏ" },
                    { q: "ุญุถุฑ ุงูุทูุงุจ ุฅูุง ุฃุฎุงู. ููุน ุงูุงุณุชุซูุงุก:", options: ["ุชุงู ูุซุจุช", "ุชุงู ูููู", "ูุงูุต ูููู", "ููุฑุบ"], a: "ุชุงู ูุซุจุช" },
                    { q: "ุซู ุงูุจุนุซ ูููู ุฐูู ุงูููุฑ ููู ููุจุนุซ ุจููุฉ . ููุน ุงูุญุงู ูู ุงูุฌููุฉ ุงูุณุงุจูุฉ :", options: ["ุฌููุฉ ุงุณููุฉ", "ููุฑุฏ", "ุฌููุฉ ูุนููุฉ", "ุดุจู ุฌููุฉ"], a: "ุฌููุฉ ุงุณููุฉ" },
                    { q: "( ูุฌุงุกูุง ุฃุจุงูู ุนุดุงุก <u>ูุจููู</u> ) ููุน ุงูุญุงู:", options: ["ุฌููุฉ ูุนููุฉ", "ููุฑุฏ", "ุฌููุฉ ุงุณููุฉ", "ุดุจู ุฌููุฉ"], a: "ุฌููุฉ ูุนููุฉ" },
                    { q: "( ุงุดุชุฑูุช <u>ูุชุฑุง</u> ููุงุดุง ) ููุน ุงููููุฒ:", options: ["ููููุธ", "ููุญูุธ", "ููุงุณู", "ุณูุงุนู"], a: "ููููุธ" },
                    { q: "( ุฎุชูุช ุจูุช ุงูุดุงุทุฆ ุงููุฑุขู ุญูุธุง ) ููุน ุงููููุฒ:", options: ["ููุญูุธ", "ููููุธ", "ููุงุณู", "ุณูุงุนู"], a: "ููุญูุธ" },
                    { q: "( ูู ูุญูุธ ุงูุทูุงุจ ุงููุตูุฏุฉ ุฅูุง ุฎุงูุฏูุง ) ุญูู ุงููุตุจ:", options: ["ุฌุงุฆุฒ", "ูุงุฌุจ", "ููุชูุน", "ุญุณุจ ูููุนู"], a: "ุฌุงุฆุฒ" },
                    { q: "ูุฌุญุฏ ุงููุงุณ ุงููุนูุฉ ุฅูุง (ุงููุคูู). ุงูุนูุงูุฉ ุงูุฅุนุฑุงุจูุฉ:", options: ["ุงููุชุญุฉ", "ุงูุถูุฉ", "ุงููุณุฑุฉ", "ุงูุณููู"], a: "ุงููุชุญุฉ" },
                    { q: "ุงุฑุชูุน ุงูุนุงูู (ูุฏุฑุง). ุงูุนูุงูุฉ ุงูุฅุนุฑุงุจูุฉ:", options: ["ุงููุชุญุฉ", "ุงูุถูุฉ", "ุงููุณุฑุฉ", "ุงูุณููู"], a: "ุงููุชุญุฉ" },
                    { q: "ููู ูุงุฏุฉ ุงููุทู (ูุดุฌุนูู). ุงูุนูุงูุฉ ุงูุฅุนุฑุงุจูุฉ:", options: ["ุงููุงุก", "ุงููุชุญุฉ", "ุงููุณุฑุฉ", "ุงูุถูุฉ"], a: "ุงููุงุก" }
                ]
            },
            {
                section: "ุตุญ ุฃู ุฎุทุฃ",
                type: "single",
                questions: [
                    { q: "( ูููู ุงููู ูุฃุนุทูู ุงูุทุฑูู ุญูู ) ูู ุตูุบ ุงููุณู", options: ["ุตุญ", "ุฎุทุฃ"], a: "ุตุญ" },
                    { q: "( ูุง ุชุฒุฑุนู ุงูููู ุชุญุตุฏู ุบุฏุง ) ุฃุณููุจ ุดุฑุท", options: ["ุตุญ", "ุฎุทุฃ"], a: "ุตุญ" },
                    { q: "( ุงูุฑูุงุถ ูุจุฑู ุงููุฏู ) ุฃุณููุจ ุชูุถูู", options: ["ุตุญ", "ุฎุทุฃ"], a: "ุตุญ" },
                    { q: "ุชุนุฏ (ูู) ูู ุฃุฏูุงุช ุงูุดุฑุท ุงูุชู ุชููุฏ ุงูุฒูุงู", options: ["ุฎุทุฃ", "ุตุญ"], a: "ุฎุทุฃ" },
                    { q: "ูุตุงุบ ุงุณู ุงูุชูุถูู ูู ุงููุนู ุงูุซูุงุซู ุงููุซุจุช ุงููุจูู ูููุนููู", options: ["ุตุญ", "ุฎุทุฃ"], a: "ุตุญ" },
                    { q: "( ู ุ ููู ุ ุญ ุ ุบ ) ูู ุงูุญุฑูู ุงูุชู ููุฒู ุฌุฒุก ูููุง ุชุญุช ุงูุณุทุฑ ูู ุฎุท ุงูุฑูุนุฉ", options: ["ุตุญ", "ุฎุทุฃ"], a: "ุตุญ" },
                    { q: "( <u>ุจูุช ุงููู</u> ุฃูุฏุณ ุงูุจููุช ) ูุง ุชุญุชู ุฎุท ุงูููุถู", options: ["ุตุญ", "ุฎุทุฃ"], a: "ุตุญ" },
                    { q: "ุฅุฐุง ุฏุฎู ุญุฑู ุงูุฌุฑ (ูู) ุนูู ( ููู ) ุชูุชุจ ( ููู )", options: ["ุตุญ", "ุฎุทุฃ"], a: "ุตุญ" },
                    { q: "ุงููุนู ุงูููุชูู ุจุฃูู ูููุฉ ุฃุตููุง ูุงู ููุชุจ ุจุฃูู ููุตูุฑุฉ", options: ["ุฎุทุฃ", "ุตุญ"], a: "ุฎุทุฃ" },
                    { q: "( ููุนุจ ุงูุฃุทูุงู ููู ูุณุฑูุฑูู ) ุงููุงู ูู ูุงู ุงูุนุทู", options: ["ุฎุทุฃ", "ุตุญ"], a: "ุฎุทุฃ" }
                ]
            },

            // --- ุงูุณุคุงู ุงูุฑุงุจุน - ูุทุนุฉ ููู ูุงุณุชูุนุงุจ ---
            {
                section: "ุงูููู ูุงูุงุณุชูุนุงุจ",
                type: "group",
                context: "ุฅู ุงููุงุฌุจ ุนูู ูู ููุงุทู ุดุฑูู ุฎุงุตุฉ ุงูุดุจุงุจ ุฃู ูุญุฐุฑ ูู ุงูุดุงุฆุนุงุช ุงููุบุฑุถุฉ ุ ูุฆูุง ูููู ูุนูู ูุฏู ูุฃูุชู ูุณุจุจ ูู ุชูุฑู ูููุชูุง ุ ููุฏ ููู ุงูุฑุณูู ุนููู ุงูุตูุงุฉ ูุงูุณูุงู ุนู ููู ููุงู ููุซุฑุฉ ุงูุณุคุงู ูุฅุถุงุนุฉ ุงููุงู .",
                questions: [
                    { q: "ูุง ุงููุงุฌุจ ุนูู ูู ููุงุทู ุดุฑููุ", options: ["ุงูุญุฐุฑ ูู ุงูุดุงุฆุนุงุช", "ูุดุฑ ุงูุฃุฎุจุงุฑ", "ุชุฌุงูู ูู ุดูุก", "ูุซุฑุฉ ุงูุญุฏูุซ"], a: "ุงูุญุฐุฑ ูู ุงูุดุงุฆุนุงุช" },
                    { q: "ุนููู ูุฌูุจ ุงูุญุฐุฑ ูู ุงูุดุงุฆุนุงุช:", options: ["ูุฆูุง ูููู ูุนูู ูุฏู ูุฃูุชู", "ูุฃููุง ูุถูุนุฉ ููููุช", "ูุฒูุงุฏุฉ ุงููุนูููุงุช", "ููุชุณููุฉ"], a: "ูุฆูุง ูููู ูุนูู ูุฏู ูุฃูุชู" },
                    { q: "ุนุฏุฏู ุงูุฃููุฑ ุงูุชู ููู ุนููุง ุงูุฑุณูู ูู ุงููุทุนุฉ:", options: ["ููู ููุงู ููุซุฑุฉ ุงูุณุคุงู", "ุงูููู ุงููุชุฃุฎุฑ", "ุงูุฅุณุฑุงู ูู ุงูุทุนุงู", "ุงูุถุญู ุงููุซูุฑ"], a: "ููู ููุงู ููุซุฑุฉ ุงูุณุคุงู" },
                    { q: "ุงูููุฑุฉ ุงูููุงุณุจุฉ ูููุต ุงูุณุงุจู:", options: ["ูุงุฌุจ ุงูููุงุทู ุชุฌุงู ูุทูู", "ุฃูููุฉ ุงููุงู", "ุขุฏุงุจ ุงูุญุฏูุซ", "ูุฎุงุทุฑ ุงูุทุฑูู"], a: "ูุงุฌุจ ุงูููุงุทู ุชุฌุงู ูุทูู" }
                ]
            }
        ];

        let currentMode = 'exam';
        let userAnswers = {}; // { 'groupIndex-questionIndex': 'value' }

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btn-exam').classList.toggle('active', mode === 'exam');
            document.getElementById('btn-practice').classList.toggle('active', mode === 'practice');
            document.getElementById('finishBtn').style.display = mode === 'practice' ? 'none' : 'block';
            initQuiz();
        }

        // Fisher-Yates Shuffle Function
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initQuiz() {
            const container = document.getElementById('cardsContainer');
            container.innerHTML = '';
            userAnswers = {};
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('resultPopup').style.display = 'none';

            quizData.forEach((block, groupIdx) => {
                
                if (block.type === 'group') {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <div class="section-badge">${block.section}</div>
                        <div class="context-box">${block.context}</div>
                    `;

                    block.questions.forEach((q, qIdx) => {
                        const qId = `${groupIdx}-${qIdx}`;
                        
                        // Copy options and shuffle them
                        const shuffledOptions = shuffleArray([...q.options]);

                        const btnsHtml = shuffledOptions.map(opt => 
                            `<button class="option-btn" onclick="selectAnswer('${qId}', '${opt}', '${q.a}', this)">${opt}</button>`
                        ).join('');

                        card.innerHTML += `
                            <div class="sub-question" id="subq-${qId}">
                                <div class="question-text">${qIdx + 1}. ${q.q}</div>
                                <div class="options-grid" id="opts-${qId}">
                                    ${btnsHtml}
                                </div>
                                <div class="feedback-msg" id="feedback-${qId}"></div>
                            </div>
                        `;
                    });
                    container.appendChild(card);

                } else {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `<div class="section-badge">${block.section}</div>`;
                    
                    block.questions.forEach((q, qIdx) => {
                        const qId = `${groupIdx}-${qIdx}`;

                        // Copy options and shuffle them
                        const shuffledOptions = shuffleArray([...q.options]);

                        const btnsHtml = shuffledOptions.map(opt => 
                            `<button class="option-btn" onclick="selectAnswer('${qId}', '${opt}', '${q.a}', this)">${opt}</button>`
                        ).join('');

                        card.innerHTML += `
                            <div class="sub-question" id="subq-${qId}">
                                <div class="question-text">${qIdx + 1}. ${q.q}</div>
                                <div class="options-grid" id="opts-${qId}">
                                    ${btnsHtml}
                                </div>
                                <div class="feedback-msg" id="feedback-${qId}"></div>
                            </div>
                        `;
                    });
                    container.appendChild(card);
                }
            });
        }

        function selectAnswer(qId, value, correctVal, btnElement) {
            const feedbackEl = document.getElementById(`feedback-${qId}`);
            const parent = document.getElementById(`opts-${qId}`);

            Array.from(parent.children).forEach(b => {
                b.classList.remove('selected');
                if (currentMode === 'exam') {
                    b.classList.remove('correct-ans', 'wrong-ans'); 
                }
            });

            btnElement.classList.add('selected');
            userAnswers[qId] = value;

            if (currentMode === 'practice') {
                if (value === correctVal) {
                    btnElement.classList.add('correct-ans');
                    feedbackEl.style.display = 'block';
                    feedbackEl.style.backgroundColor = '#d1fae5';
                    feedbackEl.style.color = 'var(--correct-color)';
                    feedbackEl.innerText = 'โ ุฅุฌุงุจุฉ ุตุญูุญุฉ';
                } else {
                    btnElement.classList.add('wrong-ans');
                    feedbackEl.style.display = 'block';
                    feedbackEl.style.backgroundColor = '#fee2e2';
                    feedbackEl.style.color = 'var(--incorrect-color)';
                    feedbackEl.innerText = 'โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ';
                }
            } else {
                feedbackEl.style.display = 'none';
            }
        }

        function finishQuiz() {
            let score = 0;
            let totalQuestions = 0;

            quizData.forEach((block, groupIdx) => {
                block.questions.forEach((q, qIdx) => {
                    totalQuestions++;
                    const qId = `${groupIdx}-${qIdx}`;
                    const feedbackEl = document.getElementById(`feedback-${qId}`);
                    const userChoice = userAnswers[qId];
                    const parent = document.getElementById(`opts-${qId}`);

                    Array.from(parent.children).forEach(btn => {
                        if (btn.innerText === q.a) {
                            btn.classList.add('correct-ans');
                        } else if (btn.innerText === userChoice && userChoice !== q.a) {
                            btn.classList.add('wrong-ans');
                        }
                    });

                    if (userChoice === q.a) {
                        score++;
                        feedbackEl.style.color = 'var(--correct-color)';
                        feedbackEl.innerText = 'โ ุฅุฌุงุจุฉ ุตุญูุญุฉ';
                        feedbackEl.style.backgroundColor = '#d1fae5';
                    } else {
                        feedbackEl.style.color = 'var(--incorrect-color)';
                        feedbackEl.innerText = userChoice ? `โ ุฅุฌุงุจุชู: ${userChoice}` : 'โ ูู ูุชู ุงูุญู';
                        feedbackEl.style.backgroundColor = '#fee2e2';
                    }
                    feedbackEl.style.display = 'block';
                });
            });

            const percent = Math.round((score / totalQuestions) * 100);
            document.getElementById('scoreCircle').innerText = `${percent}%`;
            document.getElementById('scoreDetails').innerText = `ุฃุฌุจุช ุนูู ${score} ูู ุฃุตู ${totalQuestions} ุณุคุงู ุจุดูู ุตุญูุญ.`;
            
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('resultPopup').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function closePopup() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('resultPopup').style.display = 'none';
        }

        initQuiz();

    </script>
</body>
</html>
